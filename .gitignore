version: "3.9"

services:
  omflags.api:
    build:
      context: .
      dockerfile: OMFlags.API/Dockerfile   # <- adjust if your Dockerfile path differs
    ports:
      - "7020:80"    # HTTP  -> http://localhost:7020
      - "7021:443"   # HTTPS -> https://localhost:7021
    environment:
      # ASP.NET Core hosting
      ASPNETCORE_ENVIRONMENT: "Development"
      ASPNETCORE_URLS: "http://+:80;https://+:443"

      # Enable your Blazor origin(s) for CORS.
      # In Startup/Program you read: Configuration["Cors:AllowedOrigins"]
      Cors__AllowedOrigins: "https://localhost:7245,http://localhost:7245"

      # If anything inside your API needs to call “self” or another service, use this.
      # In code: Configuration["Backend:BaseUrl"]
      Backend__BaseUrl: "https://localhost:7021/"

      # HTTPS cert for Kestrel in container (mounted below)
      ASPNETCORE_Kestrel__Certificates__Default__Path: "/https/aspnetapp.pfx"
      ASPNETCORE_Kestrel__Certificates__Default__Password: "${ASPNETCORE_HTTPS_PASSWORD}"

    volumes:
      # Mount your local dev certs folder into the container read-only
      - ~/.aspnet/https:/https:ro

    restart: unless-stopped
    networks:
      - omflags-net

networks:
  omflags-net:
    driver: bridge
